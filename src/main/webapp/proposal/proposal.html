<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Proposal</title>
<link type="text/css" href="css/jquery-ui.css" rel="stylesheet" />
<script type="text/javascript" src="js/jquery-1.9.1.js"></script>
<script type="text/javascript" src="js/jquery-ui.js"></script>
<style type="text/css">
body {
	font-size: 62.5%;
	font-family: "Trebuchet MS", "Arial", "Helvetica", "Verdana", "sans-serif";
}

#BGIMGPanel {
	position: relative;
	margin-left: auto;
	margin-right: auto;
	margin-top: 100px;
	overflow: hidden;
	text-align: center;
	z-index: -1;
}

#WordPanel {
	position: relative;
	width: 400px;
	height: 300px;
	overflow: visible;
	margin-left: 30%;
	margin-right: auto;
	margin-top: 200px;
}

div div nobr {
	font-size: 4em;
	color: yellow;
	font-style: italic;
}

</style>
<script type="text/javascript">
	var BGIMG = [ '1.jpg', '2.jpg', '3.jpg', '4.jpg', '5.jpg', '6.jpg', '7.jpg' ];
	var WORDS = [ "任玉仙小妞", "你给爷听好了", "你可爱又漂亮", "我一定要你成为我的女人", "如果你不答应", "我...", "我...", " 我...就...", " 我就一定会非常伤心", "我的生命将是不完整的", "因此", "请嫁给我吧", "I Love U" ];

	function changeBackground(index) {
		$('#BGIMGPanel').fadeOut("slow", function() {
			//$(this).css('background-image', "url('res/" + (BGIMG[index]) + "')");
			var img = $('#BGIMGPanel img');
			img.attr('src', 'res/' + BGIMG[index]);
		}).fadeIn("slow", function() {
			index = (index + 1) % BGIMG.length;
			setTimeout(function() {
				changeBackground(index);
			}, 5000);
		});
	}

	function showWords(index) {
		if (index >= WORDS.length) {
			end();
			return;
		}
		if (index > 3) {
			removeTopLine();
		}
		var word = $('<div><nobr>' + WORDS[index] + '</nobr><br/></div>');
		word.hide();
		word.appendTo($('#WordPanel'));
		word.fadeIn(3000, function() {
			showWords(index + 1);
		});
	}

	function removeTopLine() {
		$("#WordPanel div").first().remove();
	}

	function start() {
		$("#background").show();
		$("#WordPanel").show();
		changeBackground(0);
		showWords(0);
	}

	function end() {
		if (confirm("你同意吗? ( 请点是哦！:-) )?")) {
			location.href = 'countdown.html';
		} else {
			alert('选择错误:-(');
			end();
		}
	}

	function checkMatch() {
		var name1 = $("#name1").val();
		var name2 = $("#name2").val();
		if (encodeName(name1) == "987E6D77534E" && encodeName(name2) == "4EFB73894ED9") {
			return true;
		} else {
			return false;
		}
	}
	
	function encodeName(name) {
		if (!name) {
			return "";
		}
		var code = "";
		for (var i = 0; i < name.length; i++) {
			var c = name.charAt(i);
			code += c.charCodeAt().toString(16).toUpperCase();
		}
		return code;
	}
	
	function checkTime() {
		var deadline = new Date(2013, 5, 31);
		var now = new Date();
		if (now.getTime() >= deadline.getTime()) {
			location.href = 'countdown.html';
		}
	}
	
	$(function() {
		checkTime();
		
		$("#match-dialog").dialog({
			resizable : false,
			height : 150,
			modal : true,
			draggable : false,
			buttons : {
				"Match" : function() {
					if (!checkMatch()) {
						alert("名字不匹配");
						return;
					}
					$(this).dialog("close");
					start();
				}
			}
		});
	});
</script>
</head>
<body>
	<div id="match-dialog" title="Match">
	  <table>
	  	<tr>
	  		<td>他:</td>
	  		<td><input type="text" id="name1"></td>
	  	</tr>
	  	<tr>
	  		<td>她:</td>
	  		<td><input type="text" id="name2"></td>
	  	</tr>
	  </table>
	</div>
	
	<embed src="res/music.mp3" autostart="true" loop="true" hidden="true" repeat="true" playcount="true">
	<div id="background" style="position: absolute; left: 0px; top: 0px; width: 100%; height: 100%; display: none;">
		<div id="BGIMGPanel">
			<img src="">
		</div>
	</div>
	<div id="WordPanel" style="display: none;"></div>
</body>
</html>